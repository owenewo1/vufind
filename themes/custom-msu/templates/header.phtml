
<?php $account = $this->auth()->getManager(); ?>
<!-- MSM Library Header -->
<div class="newheader-image-container" style="position: relative;">
  <a href="https://library.msmnyc.edu">
    <img src="https://library.msmnyc.edu/screens/header.png" alt="MSM Logo" class="newheader-image-1"/>
  </a>
  <a href="https://library.msmnyc.edu">
    <span class="newheader-image-2">PETER JAY SHARP LIBRARY</span>
  </a>

  <div id="hoursLink">
    <div id="libraryHours"></div>
  </div>
</div>

<nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#AA0D3D;">
  <div class="container-fluid px-4">

    <!-- Left Logo / Brand (visible on all sizes) -->
    <a class="navbar-brand d-flex align-items-center" href="https://library.msmnyc.edu">
      <img src="https://library.msmnyc.edu/screens/header.png" alt="MSM Logo" height="40" class="me-2">
      <span class="d-none d-md-inline text-white fw-semibold">Peter Jay Sharp Library</span>
    </a>

    <!-- Hamburger menu button -->
    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" 
            data-bs-target="#msmNav" aria-controls="msmNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible navigation menu -->
    <div class="collapse navbar-collapse" id="msmNav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

        <!-- About -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
            About
          </a>
          <ul class="dropdown-menu dropdown-menu-dark">
            <li><a class="dropdown-item" href="https://libraryguides.msmnyc.edu/about">About the Library</a></li>
            <li><a class="dropdown-item" href="https://libraryguides.msmnyc.edu/staff">Ask the Staff</a></li>
            <li><a class="dropdown-item" href="https://library.msmnyc.edu/screens/hours.html">Library Hours</a></li>
            <li><a class="dropdown-item" href="https://libraryguides.msmnyc.edu/policies">Privileges & Policies</a></li>
          </ul>
        </li>

        <!-- Resources -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
            Resources
          </a>
          <ul class="dropdown-menu dropdown-menu-dark">
            <li><a class="dropdown-item" href="https://library.msmnyc.edu/search/Y">Catalog Search</a></li>
            <li><a class="dropdown-item" href="https://libraryguides.msmnyc.edu/az.php">Databases Aâ€“Z</a></li>
            <li><a class="dropdown-item" href="https://libraryguides.msmnyc.edu/coursereserves">Course Reserves</a></li>
            <li><a class="dropdown-item" href="https://login.msmnyc.idm.oclc.org/login?url=https://1950.account.worldcat.org/account/route/wsill/workform">Interlibrary Loans</a></li>
          </ul>
        </li>

        <!-- Account -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
            Your Account
          </a>
          <ul class="dropdown-menu dropdown-menu-dark">
            <li><a class="dropdown-item" href="<?=$this->url('myresearch-home')?>">View Your Library Account</a></li>
            <li><a class="dropdown-item" href="<?=$this->url('myresearch-logout')?>">Log Out</a></li>
          </ul>
        </li>

      </ul>
    </div>

  </div>
</nav>

<script>
function togglenewmenu() {
  var menu = document.querySelector('.newmenu');
  var icon = document.querySelector('#menuIcon');
  menu.classList.toggle('open');
  if (menu.classList.contains('open')) {
    icon.classList.remove('fa-bars');
    icon.classList.add('fa-times');
  } else {
    icon.classList.remove('fa-times');
    icon.classList.add('fa-bars');
  }
}

document.querySelectorAll('.newdropdown').forEach(function(newdropdown) {
  newdropdown.addEventListener('click', function(event) {
    if (window.innerWidth <= 800) {
      event.stopPropagation();
      this.classList.toggle('open');
    }
  });
});

window.onclick = function(event) {
  if (!event.target.matches('.newdropdown')) {
    var dropdowns = document.getElementsByClassName("newdropdown");
    for (var i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('open')) {
        openDropdown.classList.remove('open');
      }
    }
  }
};

// Library Hours fetcher
let currentDate = new Date();
async function fetchLibraryHours() {
  const response = await fetch('https://msmnyc.libcal.com/widget/hours/grid?iid=6609&format=json&weeks=52&systemTime=0');
  const data = await response.json();
  displayHoursForDate(data, currentDate);
}
function displayHoursForDate(data, date) {
  const dayOfWeek = date.toLocaleString('en-us', { weekday: 'long' });
  const formattedDate = date.toISOString().split('T')[0];
  let hoursForDate = null;
  data.locations[0].weeks.forEach(week => {
    if (week[dayOfWeek] && week[dayOfWeek].date === formattedDate) {
      hoursForDate = week[dayOfWeek];
    }
  });

  const hoursElement = document.getElementById('libraryHours');
  const linkUrl = "https://library.msmnyc.edu/screens/hours.html";
  if (hoursForDate) {
    const statusClass = hoursForDate.times && hoursForDate.times.status === 'closed' ? 'closed' : 'open';
    const formattedHours = hoursForDate.rendered.replace(/(\d+(?::\d+)?)\s*([ap]m)\s*-\s*(\d+(?::\d+)?)\s*([ap]m)/gi, '$1$2-$3$4');
    hoursElement.innerHTML = `
      <div class="${statusClass} hours-container">
        <div class="date-container">
          <span class="chevron" onclick="changeDate(-1)"><i class="bi bi-arrow-left-short"></i></span>
          <p class="today-line-break">${date.toLocaleDateString('en-us', { weekday: 'short', month: 'short', day: 'numeric' })}</p>
          <span class="chevron" onclick="changeDate(1)"><i class="bi bi-arrow-right-short"></i></span>
        </div>
        <a href="${linkUrl}" style="color:#333;text-decoration:none;">
          <p>${formattedHours}</p>
        </a>
      </div>`;
  } else {
    hoursElement.innerHTML = `
      <div class="closed hours-container">
        <div class="date-container">
          <span class="chevron" onclick="changeDate(-1)"><i class="bi bi-arrow-left-short"></i></span>
          <p class="today-line-break">${date.toLocaleDateString('en-us', { weekday: 'short', month: 'short', day: 'numeric' })}</p>
          <span class="chevron" onclick="changeDate(1)"><i class="bi bi-arrow-right-short"></i></span>
        </div>
        <a href="${linkUrl}" style="color:inherit;text-decoration:none;">
          <p>Closed</p>
        </a>
      </div>`;
  }
}
function changeDate(days) {
  currentDate.setDate(currentDate.getDate() + days);
  fetchLibraryHours();
}
fetchLibraryHours();
</script>
